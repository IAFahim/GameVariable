# üß† GameVariable.Intent

**The "Lifecycle" of Everything.** üîÑ

**GameVariable.Intent** is a high-performance, **zero-allocation** State Machine designed specifically for **Task Lifecycle Management**.

It answers the question: *"Is this AI trying to attack? Is it waiting? Did it fail? Is it done?"*

---

## üì¶ Installation

```bash
dotnet add package Variable.Intent
```

---

## üß† The Mental Model: "The Task Manager"

Don't think of this as a generic "State Machine" where you define states like `Idle`, `Walk`, `Run`.
Think of it as a **Task Tracker** for a specific action.

**Example: "Cast Fireball"**
1.  **CREATED:** The spell object is instantiated.
2.  **WAITING_TO_RUN:** Waiting for the game loop to pick it up.
3.  **RUNNING:** The animation is playing.
4.  **WAITING_FOR_CHILDREN:** It spawned a particle effect and is waiting for it to finish.
5.  **RAN_TO_COMPLETION:** The fireball exploded.
6.  **CANCELED:** The player got stunned, cancelling the spell.

**Intent** manages this flow for you, ensuring you can't go from `CREATED` directly to `COMPLETED` without running.

---

## üöÄ Features

*   **‚ö° Zero Allocation:** Pure struct-based design. No GC pressure.
*   **üõ°Ô∏è Robust Lifecycle:** Enforces a safe state flow (Created -> Running -> Completed).
*   **üå≥ Hierarchical:** Built-in support for pausing while child tasks complete.
*   **üèéÔ∏è Autogenerated:** Powered by [StateSmith](https://github.com/StateSmith/StateSmith) for optimized switch-case logic.

---

## üéÆ Usage Guide

### 1. Basic Lifecycle

```csharp
using GameVariable.Intent;

// 1. Create the tracker
var intent = new IntentState();
intent.Start(); // State: CREATED

// 2. Activate it (e.g. when added to a queue)
intent.DispatchEvent(IntentState.EventId.ACTIVATED); // State: WAITING_TO_RUN

// 3. Start execution (e.g. inside your Update loop)
if (intent.stateId == IntentState.StateId.WAITING_TO_RUN)
{
    intent.DispatchEvent(IntentState.EventId.START_RUNNING); // State: RUNNING
}

// 4. Do the work
if (intent.stateId == IntentState.StateId.RUNNING)
{
    DoFireballLogic();

    if (AnimationFinished())
    {
        intent.DispatchEvent(IntentState.EventId.COMPLETED_SUCCESSFULLY); // State: RAN_TO_COMPLETION
    }
}
```

### 2. Handling Failure

```csharp
if (intent.stateId == IntentState.StateId.RUNNING)
{
    if (PlayerInterrupted())
    {
        intent.DispatchEvent(IntentState.EventId.CANCEL); // State: CANCELED
    }
    else if (OutOfMana())
    {
        intent.DispatchEvent(IntentState.EventId.UNABLE_TO_COMPLETE); // State: FAULTED
    }
}
```

### 3. Hierarchical Tasks (Sub-States)

Perfect for complex moves like "Cast Spell" (Channel -> Cast -> Recover).

```csharp
// We are in RUNNING state
void UpdateSpell()
{
    // Need to spawn a sub-task?
    if (NeedsToCharge)
    {
        SpawnChargeUpTask();
        // Pause this intent, wait for child
        intent.DispatchEvent(IntentState.EventId.CHILD_TASK_CREATED);
        // State: WAITING_FOR_CHILDREN_TO_COMPLETE
    }

    // ... later, when child task signals it's done ...

    intent.DispatchEvent(IntentState.EventId.ALL_CHILDREN_COMPLETED);
    // State: RUNNING (Resumed)
}
```

---

## üîß API Reference

### `IntentState.StateId`
The machine can only be in one of these states:
*   `CREATED`: Freshly made.
*   `WAITING_TO_RUN`: Activated, queued for execution.
*   `RUNNING`: Currently doing its job.
*   `WAITING_FOR_CHILDREN_TO_COMPLETE`: Paused, waiting for sub-tasks.
*   `RAN_TO_COMPLETION`: Finished successfully.
*   `FAULTED`: Something went wrong (error).
*   `CANCELED`: Stopped externally.
*   `WAITING_FOR_ACTIVATION`: (Optional) Delayed start.

### `IntentState.EventId`
Triggers you send to change state:
*   `ACTIVATED`, `GET_READY`
*   `START_RUNNING`
*   `CHILD_TASK_CREATED`, `ALL_CHILDREN_COMPLETED`
*   `COMPLETED_SUCCESSFULLY`, `UNABLE_TO_COMPLETE`
*   `CANCEL`
*   `RECOVER_RETRY` (Retry from Faulted)

---

<div align="center">

**Part of the [GameVariable](https://github.com/iafahim/GameVariable) Ecosystem**
*Made with ‚ù§Ô∏è for game developers*

</div>
